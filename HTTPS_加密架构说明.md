# HTTPSä¼ è¾“å±‚åŠ å¯†æ¶æ„è¯´æ˜

> CrossWireé¡¹ç›®çš„HTTPS/WebSocketä¼ è¾“æ¨¡å¼åŠ å¯†è®¾è®¡

---

## ğŸ” åŠ å¯†æ¶æ„æ¦‚è§ˆ

HTTPSæ¨¡å¼é‡‡ç”¨**ä¸‰å±‚ä¿æŠ¤**è®¾è®¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åº”ç”¨å±‚ (Client/Server)              â”‚
â”‚  - æ„é€ ä¸šåŠ¡æ¶ˆæ¯ (JSON)                       â”‚
â”‚  - ä½¿ç”¨ crypto.EncryptMessage() åŠ å¯†         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
         [AES-256-GCMåŠ å¯†åçš„æ•°æ®]
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ä¼ è¾“å±‚ (HTTPS/WebSocket)           â”‚
â”‚  - æ¥æ”¶å·²åŠ å¯†çš„ Payload                      â”‚
â”‚  - JSONåºåˆ—åŒ– transport.Message              â”‚
â”‚  - WebSocketäºŒè¿›åˆ¶å¸§ä¼ è¾“                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
         [TLSåŠ å¯†çš„WebSocketæµ]
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         TLSå±‚ (Transport Security)          â”‚
â”‚  - TLS 1.2+ åŠ å¯†é€šé“                         â”‚
â”‚  - è¯ä¹¦éªŒè¯ï¼ˆå¯é€‰ï¼‰                           â”‚
â”‚  - å®Œæ•´æ€§ä¿æŠ¤                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
              [ç½‘ç»œä¼ è¾“ - TCP]
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         TLSå±‚ (æ¥æ”¶ç«¯)                       â”‚
â”‚  - TLSè§£å¯†                                   â”‚
â”‚  - è¯ä¹¦éªŒè¯                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
         [WebSocketäºŒè¿›åˆ¶å¸§]
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ä¼ è¾“å±‚ (æ¥æ”¶ç«¯)                     â”‚
â”‚  - WebSocketå¸§è§£æ                           â”‚
â”‚  - JSONååºåˆ—åŒ– transport.Message            â”‚
â”‚  - æå– Payload                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
         [AES-256-GCMåŠ å¯†åçš„æ•°æ®]
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åº”ç”¨å±‚ (Client/Server)              â”‚
â”‚  - ä½¿ç”¨ crypto.DecryptMessage() è§£å¯†         â”‚
â”‚  - è§£æä¸šåŠ¡æ¶ˆæ¯ (JSON)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒŸ HTTPSæ¨¡å¼ç‰¹ç‚¹

### ä¸ARP/mDNSæ¨¡å¼çš„åŒºåˆ«

| ç‰¹æ€§ | ARPæ¨¡å¼ | mDNSæ¨¡å¼ | HTTPSæ¨¡å¼ |
|------|---------|----------|-----------|
| **ä¼ è¾“åè®®** | åŸå§‹ä»¥å¤ªç½‘å¸§ | mDNSå®£å‘ŠåŒ… | WebSocket over TLS |
| **ç½‘ç»œå±‚çº§** | é“¾è·¯å±‚(L2) | åº”ç”¨å±‚(L7) | åº”ç”¨å±‚(L7) |
| **åŠ å¯†æ–¹å¼** | åº”ç”¨å±‚AES | åº”ç”¨å±‚AES | åº”ç”¨å±‚AES + TLS |
| **è¿æ¥æ¨¡å¼** | å•æ’­/å¹¿æ’­ | å¤šæ’­/å•æ’­ | é•¿è¿æ¥ |
| **NATç©¿é€** | âŒ ä¸æ”¯æŒ | âŒ å±€åŸŸç½‘å†… | âœ… æ”¯æŒ |
| **äº’è”ç½‘é€šä¿¡** | âŒ ä»…å±€åŸŸç½‘ | âŒ ä»…å±€åŸŸç½‘ | âœ… æ”¯æŒ |
| **è¯ä¹¦éªŒè¯** | âŒ æ—  | âŒ æ—  | âœ… å¯é€‰ |
| **åŒé‡åŠ å¯†** | âŒ å•å±‚ | âŒ å•å±‚ | âœ… AES+TLS |

---

## ğŸ“ åŠ å¯†å®ç°ä½ç½®

### 1. **TLSåŠ å¯†å±‚** (Goæ ‡å‡†åº“)

**ä½ç½®:** `crypto/tls` æ ‡å‡†åº“

**é…ç½®:** `internal/transport/https_transport.go:172-174`

```go
TLSConfig: &tls.Config{
    MinVersion: tls.VersionTLS12,  // æœ€ä½TLS 1.2
}
```

**è¯ä¹¦ç®¡ç†:**

```go
// Line 180-193
if t.config.TLSCert != "" && t.config.TLSKey != "" {
    // ä½¿ç”¨å¤–éƒ¨æä¾›çš„è¯ä¹¦
    err = t.server.ListenAndServeTLS(t.config.TLSCert, t.config.TLSKey)
} else {
    // è‡ªåŠ¨ç”Ÿæˆè‡ªç­¾åè¯ä¹¦
    certPath, keyPath, genErr := utils.EnsureSelfSignedCert("./certs", nil, 365)
    if genErr == nil {
        t.logInfo("Using self-signed TLS cert: %s", certPath)
        err = t.server.ListenAndServeTLS(certPath, keyPath)
    } else {
        // å›é€€åˆ°éTLSï¼ˆä»…å½“ç”Ÿæˆå¤±è´¥ï¼‰
        t.logWarn("Self-signed cert generation failed, falling back to HTTP")
        err = t.server.ListenAndServe()
    }
}
```

**å®¢æˆ·ç«¯TLSé…ç½®:**

```go
// Line 259-266
dialer := websocket.DefaultDialer
if strings.HasPrefix(wsURL, "wss://") {
    if t.config != nil && t.config.SkipTLSVerify {
        // è·³è¿‡è¯ä¹¦éªŒè¯ï¼ˆå¼€å‘ç¯å¢ƒ/è‡ªç­¾åè¯ä¹¦ï¼‰
        dialer.TLSClientConfig = &tls.Config{
            InsecureSkipVerify: true,
        }
    }
}
```

---

### 2. **WebSocketå±‚** (`github.com/gorilla/websocket`)

**ä½œç”¨:** åœ¨TLSé€šé“ä¸Šå»ºç«‹WebSocketè¿æ¥

**æœåŠ¡å™¨ç«¯:**

```go
// Line 615-621: WebSocketå‡çº§
upgrader := websocket.Upgrader{
    ReadBufferSize:  4096,
    WriteBufferSize: 4096,
    CheckOrigin: func(r *http.Request) bool {
        return true  // TODO: æ·»åŠ å®‰å…¨çš„Originæ£€æŸ¥
    },
}

conn, err := upgrader.Upgrade(w, r, nil)
```

**å®¢æˆ·ç«¯:**

```go
// Line 269-270: è¿æ¥WebSocket
conn, _, err := dialer.Dial(wsURL, nil)
```

**æ¶ˆæ¯æ ¼å¼:** äºŒè¿›åˆ¶å¸§ (`websocket.BinaryMessage`)

---

### 3. **åº”ç”¨å±‚AESåŠ å¯†** (ä¸ARPæ¨¡å¼ç›¸åŒ)

**å®ç°ä½ç½®:** `internal/crypto/crypto.go:30-83`

#### åŠ å¯†æµç¨‹

```go
// 1. åº”ç”¨å±‚åŠ å¯†ï¼ˆä¸ARPæ¨¡å¼å®Œå…¨ç›¸åŒï¼‰
encrypted = crypto.EncryptMessage(signedJSON)

// 2. æ„é€ ä¼ è¾“å±‚æ¶ˆæ¯
transportMsg := &transport.Message{
    Type:      transport.MessageTypeData,
    Payload:   encrypted,  // å·²åŠ å¯†çš„æ•°æ®
    Timestamp: time.Now(),
}

// 3. JSONåºåˆ—åŒ–ä¼ è¾“å±‚æ¶ˆæ¯
msgData, _ := json.Marshal(transportMsg)

// 4. é€šè¿‡WebSocketå‘é€ï¼ˆè‡ªåŠ¨TLSåŠ å¯†ï¼‰
conn.WriteMessage(websocket.BinaryMessage, msgData)
```

---

## ğŸ”„ å®Œæ•´æ•°æ®æµ

### å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åŸå§‹æ¶ˆæ¯                                  â”‚
â”‚    {"type": "text", "content": "Hello"}     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ client.SendMessage()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. åº”ç”¨å±‚ç­¾å (Ed25519)                      â”‚
â”‚    SignedMessage {                          â”‚
â”‚      message: "{...}",                      â”‚
â”‚      signature: "0x...",                    â”‚
â”‚      sender_id: "alice"                     â”‚
â”‚    }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ crypto.EncryptMessage()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. AES-256-GCMåŠ å¯† (åº”ç”¨å±‚)                  â”‚
â”‚    [nonce][encrypted_data][auth_tag]        â”‚
â”‚    0x4a7b2c... (å¯†æ–‡)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ transport.SendMessage()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ„é€ ä¼ è¾“å±‚æ¶ˆæ¯                            â”‚
â”‚    transport.Message {                      â”‚
â”‚      type: MessageTypeData,                 â”‚
â”‚      payload: 0x4a7b2c...,  // å·²åŠ å¯†       â”‚
â”‚      timestamp: 1234567890                  â”‚
â”‚    }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ json.Marshal()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. JSONåºåˆ—åŒ–                                â”‚
â”‚    {"type":1,"payload":"...","timestamp":...}â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ WebSocket.WriteMessage()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. WebSocketäºŒè¿›åˆ¶å¸§                         â”‚
â”‚    [FIN=1][Opcode=Binary][Payload=...]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ TLSåŠ å¯†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. TLSåŠ å¯†è®°å½•                               â”‚
â”‚    TLS Record {                             â”‚
â”‚      type: Application Data,                â”‚
â”‚      version: TLS 1.2,                      â”‚
â”‚      encrypted: 0x9f8e...                   â”‚
â”‚    }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ TCPä¼ è¾“
          [ç½‘ç»œä¼ è¾“ - Internet]
                â†“ TCPæ¥æ”¶
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. æœåŠ¡å™¨TLSè§£å¯†                             â”‚
â”‚    â†’ WebSocketå¸§                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ JSONååºåˆ—åŒ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. æå–transport.Message                    â”‚
â”‚    payload: 0x4a7b2c... (ä»æ˜¯åŠ å¯†çš„)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ handler(msg)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. Server.handleIncomingMessage()          â”‚
â”‚     â†’ MessageRouter.processMessageTask()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ crypto.DecryptMessage()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. AES-256-GCMè§£å¯† (åº”ç”¨å±‚)                â”‚
â”‚     SignedMessage {                         â”‚
â”‚       message: "{...}",                     â”‚
â”‚       signature: "0x..."                    â”‚
â”‚     }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ Ed25519éªŒè¯
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 12. è§£æä¸šåŠ¡æ¶ˆæ¯                             â”‚
â”‚     {"type": "text", "content": "Hello"}    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœåŠ¡å™¨å¹¿æ’­æ¶ˆæ¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ä¸šåŠ¡æ¶ˆæ¯                                  â”‚
â”‚    {"type": "text", "content": "World"}     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ BroadcastManager.Broadcast()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. JSONåºåˆ—åŒ–                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ crypto.EncryptMessage()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. AES-256-GCMåŠ å¯† (åº”ç”¨å±‚)                  â”‚
â”‚    0x8f3a1c... (å¯†æ–‡)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ æœåŠ¡å™¨ç­¾å
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Ed25519ç­¾å (åº”ç”¨å±‚)                      â”‚
â”‚    SignedPayload {                          â”‚
â”‚      message: 0x8f3a1c...,                  â”‚
â”‚      signature: "0xab12...",                â”‚
â”‚      timestamp: 1234567890,                 â”‚
â”‚      server_id: "channel_id"                â”‚
â”‚    }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ json.Marshal()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. JSONåºåˆ—åŒ–SignedPayload                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ transport.SendMessage()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æ„é€ transport.Message                    â”‚
â”‚    JSONåºåˆ—åŒ–                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ broadcast()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. éå†æ‰€æœ‰WebSocketè¿æ¥                     â”‚
â”‚    é€ä¸ªå‘é€ (TLSåŠ å¯†é€šé“)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ TLSåŠ å¯† + TCPä¼ è¾“
          [ç½‘ç»œä¼ è¾“ - Internet]
                â†“ å®¢æˆ·ç«¯æ¥æ”¶
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. å®¢æˆ·ç«¯TLSè§£å¯†                             â”‚
â”‚    â†’ WebSocketå¸§ â†’ JSONååºåˆ—åŒ–              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ ReceiveManager.handleTransportMessage()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. è§£æSignedPayload                        â”‚
â”‚    æå–messageå­—æ®µ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ crypto.DecryptMessage()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. AES-256-GCMè§£å¯†                         â”‚
â”‚     {"type": "text", "content": "World"}    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ å¯†é’¥ä½“ç³»

### ä¸‰å±‚å¯†é’¥

| å¯†é’¥ç±»å‹ | ç®—æ³• | ç”¨é€” | ä½œç”¨åŸŸ |
|---------|------|------|-------|
| **é¢‘é“å¯†é’¥** | AES-256 | æ¶ˆæ¯å†…å®¹åŠ å¯† | æ‰€æœ‰é¢‘é“æˆå‘˜å…±äº« |
| **æœåŠ¡å™¨ç­¾åå¯†é’¥** | Ed25519 | æ¶ˆæ¯æ¥æºè®¤è¯ | æœåŠ¡å™¨ç§é’¥ |
| **å®¢æˆ·ç«¯ç­¾åå¯†é’¥** | Ed25519 | ç”¨æˆ·æ¶ˆæ¯ç­¾å | æ¯ä¸ªå®¢æˆ·ç«¯ç§é’¥ |
| **TLSä¼šè¯å¯†é’¥** | åå•†ç”Ÿæˆ | ä¼ è¾“å±‚åŠ å¯† | æ¯ä¸ªTCPè¿æ¥ç‹¬ç«‹ |

### å¯†é’¥æ´¾ç”Ÿå’Œåå•†

```
1. åº”ç”¨å±‚å¯†é’¥ï¼ˆé¢‘é“å¯†é’¥ï¼‰:
   é¢‘é“å¯†ç  â†’ PBKDF2 â†’ AES-256å¯†é’¥ (32å­—èŠ‚)

2. TLSä¼šè¯å¯†é’¥ï¼ˆä¼ è¾“å±‚ï¼‰:
   TLSæ¡æ‰‹ â†’ ECDHEå¯†é’¥äº¤æ¢ â†’ ä¼šè¯å¯†é’¥
   â””â”€ å®Œç¾å‰å‘ä¿å¯† (PFS)
```

---

## ğŸ›¡ï¸ ä¸‰å±‚ä¿æŠ¤æœºåˆ¶

### 1ï¸âƒ£ AES-256-GCMåŠ å¯†ï¼ˆåº”ç”¨å±‚ï¼‰

**ä¿æŠ¤ç›®æ ‡:** ç«¯åˆ°ç«¯æ¶ˆæ¯å†…å®¹æœºå¯†æ€§

**ç‰¹ç‚¹:**
- âœ… å¯¹ç§°åŠ å¯†ï¼Œæ€§èƒ½é«˜
- âœ… GCMæ¨¡å¼æä¾›è®¤è¯åŠ å¯†(AEAD)
- âœ… å³ä½¿TLSè¢«ç ´è§£ï¼Œæ¶ˆæ¯å†…å®¹ä»ç„¶å®‰å…¨
- âœ… å³ä½¿æœåŠ¡å™¨è¢«æ”»ç ´ï¼Œæ— æ³•è§£å¯†æ¶ˆæ¯

**æ ¼å¼:**
```
[12 bytes Nonce][N bytes Ciphertext][16 bytes Auth Tag]
```

### 2ï¸âƒ£ Ed25519ç­¾åï¼ˆåº”ç”¨å±‚ï¼‰

**ä¿æŠ¤ç›®æ ‡:** æ¶ˆæ¯æ¥æºè®¤è¯å’Œä¸å¯æŠµèµ–æ€§

**ç‰¹ç‚¹:**
- âœ… éå¯¹ç§°ç­¾åï¼Œé˜²å†’å……
- âœ… å®¢æˆ·ç«¯ç­¾åè‡ªå·±çš„æ¶ˆæ¯
- âœ… æœåŠ¡å™¨ç­¾åå¹¿æ’­æ¶ˆæ¯
- âœ… å³ä½¿WebSocketè¿æ¥è¢«åŠ«æŒï¼Œæ— æ³•ä¼ªé€ æ¶ˆæ¯

### 3ï¸âƒ£ TLSåŠ å¯†ï¼ˆä¼ è¾“å±‚ï¼‰

**ä¿æŠ¤ç›®æ ‡:** ä¼ è¾“è¿‡ç¨‹ä¿å¯†æ€§å’Œå®Œæ•´æ€§

**ç‰¹ç‚¹:**
- âœ… æˆç†Ÿçš„å·¥ä¸šæ ‡å‡†
- âœ… é˜²æ­¢ä¸­é—´äººçªƒå¬
- âœ… è¯ä¹¦éªŒè¯æœåŠ¡å™¨èº«ä»½ï¼ˆå¯é€‰ï¼‰
- âœ… å®Œç¾å‰å‘ä¿å¯†ï¼ˆPFSï¼‰

---

## ğŸ” å®‰å…¨çº§åˆ«å¯¹æ¯”

### HTTPS vs ARP/mDNS

| å®‰å…¨ç‰¹æ€§ | ARPæ¨¡å¼ | mDNSæ¨¡å¼ | HTTPSæ¨¡å¼ |
|---------|---------|----------|-----------|
| **åº”ç”¨å±‚åŠ å¯†** | âœ… AES-256-GCM | âœ… AES-256-GCM | âœ… AES-256-GCM |
| **åº”ç”¨å±‚ç­¾å** | âœ… Ed25519 | âœ… Ed25519 | âœ… Ed25519 |
| **ä¼ è¾“å±‚åŠ å¯†** | âŒ æ—  | âŒ æ—  | âœ… TLS 1.2+ |
| **è¯ä¹¦è®¤è¯** | âŒ æ—  | âŒ æ—  | âœ… å¯é€‰ |
| **å®Œç¾å‰å‘ä¿å¯†** | âŒ æ—  | âŒ æ—  | âœ… æœ‰ |
| **æŠ—å—…æ¢** | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ¡ ä¸­ç­‰ | âœ… é«˜ |
| **æŠ—é‡æ”¾** | âœ… æ—¶é—´æˆ³ | âœ… æ—¶é—´æˆ³ | âœ… æ—¶é—´æˆ³+TLS |
| **æŠ—ä¸­é—´äºº** | ğŸŸ¡ ç­¾å | ğŸŸ¡ ç­¾å | âœ… TLS+ç­¾å |

**å®‰å…¨ç­‰çº§æ’åº:** HTTPS > ARP â‰ˆ mDNS

---

## ğŸ¯ ä¸ºä»€ä¹ˆä½¿ç”¨ä¸‰å±‚ä¿æŠ¤ï¼Ÿ

### æ·±åº¦é˜²å¾¡åŸåˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¦‚æœTLSè¢«ç ´è§£ï¼ˆä¾‹å¦‚è¯ä¹¦æ³„éœ²ï¼‰        â”‚
â”‚  â†“                                   â”‚
â”‚  æ¶ˆæ¯ä»è¢«AES-256-GCMä¿æŠ¤              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¦‚æœAESå¯†é’¥è¢«çªƒå–ï¼ˆé¢‘é“å¯†ç æ³„éœ²ï¼‰    â”‚
â”‚  â†“                                   â”‚
â”‚  æ— æ³•ä¼ªé€ æ¶ˆæ¯ï¼ˆéœ€è¦ç§é’¥ç­¾åï¼‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¦‚æœæœåŠ¡å™¨è¢«æ”»ç ´                     â”‚
â”‚  â†“                                   â”‚
â”‚  æ— æ³•è§£å¯†å†å²æ¶ˆæ¯ï¼ˆåªæœ‰é¢‘é“æˆå‘˜çŸ¥å¯†ç ï¼‰â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èŒè´£åˆ†ç¦»

1. **TLSå±‚:** ä¿æŠ¤ä¼ è¾“è¿‡ç¨‹ï¼Œé˜²æ­¢ç½‘ç»œçªƒå¬
2. **åº”ç”¨å±‚åŠ å¯†:** ç«¯åˆ°ç«¯ä¿æŠ¤ï¼Œå³ä½¿ç»è¿‡ä¸å¯ä¿¡ä¸­ç»§
3. **åº”ç”¨å±‚ç­¾å:** èº«ä»½è®¤è¯ï¼Œé˜²æ­¢å†’å……

---

## ğŸ“Š æ€§èƒ½å½±å“

### åŠ å¯†å¼€é”€å¯¹æ¯”

| æ“ä½œ | æ—¶é—´ | è¯´æ˜ |
|------|------|------|
| **AES-256-GCMåŠ å¯†** | ~20Î¼s | åº”ç”¨å±‚ï¼ˆä¸ARPç›¸åŒï¼‰ |
| **Ed25519ç­¾å** | ~100Î¼s | åº”ç”¨å±‚ï¼ˆä¸ARPç›¸åŒï¼‰ |
| **TLSæ¡æ‰‹** | ~1-5ms | è¿æ¥å»ºç«‹æ—¶ä¸€æ¬¡æ€§ |
| **TLSåŠ å¯†/è§£å¯†** | ~50Î¼s | ä¼ è¾“å±‚ï¼ˆç¡¬ä»¶åŠ é€Ÿï¼‰ |
| **æ€»å»¶è¿Ÿ** | ~170Î¼s + TLS | æ¯æ¡æ¶ˆæ¯ |

**å¯¹æ¯”:**
- ARPæ¨¡å¼: ~185Î¼s (æ— TLS)
- HTTPSæ¨¡å¼: ~220Î¼s (å«TLS)
- **é¢å¤–å¼€é”€:** ä»…~35Î¼s (TLSåŠ å¯†)

**ç»“è®º:** âœ… TLSå¼€é”€å¾ˆå°ï¼Œå®‰å…¨æ€§æå‡æ˜¾è‘—

---

## ğŸ”§ é…ç½®é€‰é¡¹

### æœåŠ¡å™¨ç«¯é…ç½®

```go
// internal/server/server.go
config := &ServerConfig{
    TransportMode: models.TransportHTTPS,
    TransportConfig: &transport.Config{
        Port: 8443,
        
        // TLSé…ç½®
        TLSCert: "./certs/server.crt",  // å¯é€‰ï¼šå¤–éƒ¨è¯ä¹¦
        TLSKey:  "./certs/server.key",  // å¯é€‰ï¼šå¤–éƒ¨å¯†é’¥
        
        // è¶…æ—¶é…ç½®
        ReadTimeout:  30 * time.Second,
        WriteTimeout: 30 * time.Second,
    },
    
    // å®‰å…¨é…ç½®
    EnableSignature: true,  // å¯ç”¨æœåŠ¡å™¨ç­¾å
}
```

### å®¢æˆ·ç«¯é…ç½®

```go
// internal/client/client.go
config := &Config{
    TransportMode: models.TransportHTTPS,
    TransportConfig: &transport.Config{
        ServerAddress: "server.example.com",
        Port:          8443,
        
        // TLSé…ç½®
        SkipTLSVerify: false,  // ç”Ÿäº§ç¯å¢ƒå»ºè®®false
        
        // é‡è¿é…ç½®
        MaxRetries:   3,
        RetryDelay:   1 * time.Second,
    },
}
```

### è‡ªç­¾åè¯ä¹¦é…ç½®

```go
// è‡ªåŠ¨ç”Ÿæˆè‡ªç­¾åè¯ä¹¦
// utils.EnsureSelfSignedCert() ä¼šï¼š
// 1. æ£€æŸ¥ ./certs/server.crt æ˜¯å¦å­˜åœ¨
// 2. ä¸å­˜åœ¨åˆ™è‡ªåŠ¨ç”Ÿæˆ
// 3. æœ‰æ•ˆæœŸ365å¤©
// 4. RSA 2048ä½å¯†é’¥

// å®¢æˆ·ç«¯éœ€è¦è®¾ç½® SkipTLSVerify: true
```

---

## ğŸŒ WebSocketåè®®ç‰¹æ€§

### ä¸ºä»€ä¹ˆé€‰æ‹©WebSocketï¼Ÿ

| ç‰¹æ€§ | HTTP | WebSocket | ä¼˜åŠ¿ |
|------|------|-----------|------|
| **è¿æ¥æ¨¡å¼** | çŸ­è¿æ¥ | é•¿è¿æ¥ | âœ… å‡å°‘æ¡æ‰‹å¼€é”€ |
| **åŒå‘é€šä¿¡** | è¯·æ±‚-å“åº” | å…¨åŒå·¥ | âœ… æœåŠ¡å™¨ä¸»åŠ¨æ¨é€ |
| **æ¶ˆæ¯è¾¹ç•Œ** | æ—  | æœ‰ | âœ… å¤©ç„¶åˆ†å¸§ |
| **å¤´éƒ¨å¼€é”€** | å¤§(~500B) | å°(2-14B) | âœ… èŠ‚çœå¸¦å®½ |
| **å»¶è¿Ÿ** | é«˜ | ä½ | âœ… å®æ—¶æ€§å¥½ |

### å¿ƒè·³æœºåˆ¶

```go
// Ping/Pongå¿ƒè·³ä¿æŒè¿æ¥æ´»è·ƒ
pingInterval: 20 * time.Second  // æ¯20ç§’å‘é€Ping
pongWait:     60 * time.Second  // 60ç§’å†…æœªæ”¶åˆ°Pongåˆ™æ–­å¼€
```

**ä½œç”¨:**
1. æ£€æµ‹è¿æ¥çŠ¶æ€
2. ä¿æŒNATæ˜ å°„
3. è§¦å‘è‡ªåŠ¨é‡è¿

### è‡ªåŠ¨é‡è¿

```go
// æŒ‡æ•°é€€é¿é‡è¿
reconnectDelay:    1 * time.Second   // åˆå§‹1ç§’
reconnectMaxDelay: 15 * time.Second  // æœ€å¤š15ç§’
```

**ç­–ç•¥:**
```
ç¬¬1æ¬¡é‡è¿: 1ç§’å
ç¬¬2æ¬¡é‡è¿: 2ç§’å
ç¬¬3æ¬¡é‡è¿: 4ç§’å
ç¬¬4æ¬¡é‡è¿: 8ç§’å
ç¬¬5æ¬¡é‡è¿: 15ç§’åï¼ˆå°é¡¶ï¼‰
```

---

## ğŸš€ ä¼˜åŠ¿æ€»ç»“

### ç›¸æ¯”ARP/mDNSæ¨¡å¼

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| **äº’è”ç½‘é€šä¿¡** | âœ… æ”¯æŒè·¨åœ°åŸŸã€è·¨ç½‘ç»œé€šä¿¡ |
| **NATç©¿é€** | âœ… å¤©ç„¶æ”¯æŒNATå’Œé˜²ç«å¢™ |
| **æ ‡å‡†åè®®** | âœ… æ‰€æœ‰æµè§ˆå™¨å’Œå®¢æˆ·ç«¯æ”¯æŒ |
| **TLSåŠ å¯†** | âœ… é¢å¤–çš„ä¼ è¾“å±‚ä¿æŠ¤ |
| **è¯ä¹¦è®¤è¯** | âœ… å¯éªŒè¯æœåŠ¡å™¨èº«ä»½ |
| **æ— éœ€æƒé™** | âœ… ä¸éœ€è¦ç®¡ç†å‘˜æƒé™ |
| **ç¨³å®šå¯é ** | âœ… TCPä¿è¯æ¶ˆæ¯é¡ºåºå’Œå¯é æ€§ |

### é€‚ç”¨åœºæ™¯

âœ… **æ¨èä½¿ç”¨HTTPSæ¨¡å¼:**
- è·¨äº’è”ç½‘é€šä¿¡
- ç§»åŠ¨å®¢æˆ·ç«¯æ¥å…¥
- äº‘æœåŠ¡å™¨éƒ¨ç½²
- å…¬ç½‘ç¯å¢ƒ
- éœ€è¦è¯ä¹¦è®¤è¯çš„åœºæ™¯
- ä¼ä¸šç”Ÿäº§ç¯å¢ƒ

âš ï¸ **ä½¿ç”¨ARP/mDNSæ¨¡å¼:**
- çº¯å±€åŸŸç½‘é€šä¿¡
- è¿½æ±‚æè‡´éšè”½æ€§
- ç»•è¿‡ç½‘ç»œå®¡æŸ¥
- CTFæ¯”èµ›ç¯å¢ƒ

---

## ğŸ”„ ä¸å…¶ä»–æ¨¡å¼åä½œ

### æ··åˆéƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å±€åŸŸç½‘ç¯å¢ƒ                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ARP    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Client A â”‚ â†------â†’  â”‚ Server   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                             â†• HTTPS         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                         (Internet)
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              äº‘ç¯å¢ƒ          â†•                â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                         â”‚ Client B â”‚         â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åœºæ™¯:**
- å±€åŸŸç½‘å®¢æˆ·ç«¯ä½¿ç”¨ARPï¼ˆé«˜éšè”½æ€§ï¼‰
- è¿œç¨‹å®¢æˆ·ç«¯ä½¿ç”¨HTTPSï¼ˆäº’è”ç½‘æ¥å…¥ï¼‰
- æœåŠ¡å™¨åŒæ—¶æ”¯æŒä¸¤ç§æ¨¡å¼

---

## ğŸ“ å®ç°ç»†èŠ‚

### ä¼ è¾“å±‚å®ç°

**ä½ç½®:** `internal/transport/https_transport.go`

**å…³é”®æ–¹æ³•:**

```go
// SendMessage (Line 338-352)
func (t *HTTPSTransport) SendMessage(msg *Message) error {
    // 1. JSONåºåˆ—åŒ–transport.Message
    data, _ := json.Marshal(msg)
    
    if t.mode == "server" {
        // 2. æœåŠ¡ç«¯ï¼šå¹¿æ’­åˆ°æ‰€æœ‰WebSocketå®¢æˆ·ç«¯
        return t.broadcast(data)
    } else {
        // 2. å®¢æˆ·ç«¯ï¼šå‘é€åˆ°æœåŠ¡å™¨
        return t.send(data)
    }
}

// send (Line 354-387)
func (t *HTTPSTransport) send(data []byte) error {
    // é€šè¿‡WebSocketå‘é€ï¼ˆè‡ªåŠ¨TLSåŠ å¯†ï¼‰
    err := conn.WriteMessage(websocket.BinaryMessage, data)
    return err
}

// broadcast (Line 389-424)
func (t *HTTPSTransport) broadcast(data []byte) error {
    // éå†æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥
    for clientID, conn := range t.clients {
        // é€ä¸ªå‘é€ï¼ˆæ¯ä¸ªè¿æ¥ç‹¬ç«‹TLSåŠ å¯†ï¼‰
        conn.WriteMessage(websocket.BinaryMessage, data)
    }
    return nil
}
```

### åº”ç”¨å±‚è°ƒç”¨

**ä¸ARPæ¨¡å¼å®Œå…¨ç›¸åŒ:**

```go
// å®¢æˆ·ç«¯å‘é€ (client.go:608)
encrypted, _ := c.crypto.EncryptMessage(signedJSON)
c.transport.SendMessage(&transport.Message{
    Payload: encrypted,  // å·²åŠ å¯†
})

// æœåŠ¡å™¨æ¥æ”¶ (message_router.go:113)
decrypted, _ := mr.server.crypto.DecryptMessage(
    task.TransportMessage.Payload,
)

// æœåŠ¡å™¨å¹¿æ’­ (broadcast_manager.go:129)
encryptedData, _ := bm.server.crypto.EncryptMessage(messageData)
bm.server.transport.SendMessage(&transport.Message{
    Payload: encryptedData,  // å·²åŠ å¯†
})
```

---

## âœ… å®‰å…¨æ€§éªŒè¯

### åŠ å¯†å±‚æ£€æŸ¥

| å±‚çº§ | ç®—æ³• | å¯†é’¥é•¿åº¦ | è®¤è¯ | çŠ¶æ€ |
|------|------|---------|------|------|
| **TLS** | AES-128/256 | 128/256ä½ | âœ… HMAC | âœ… |
| **åº”ç”¨å±‚AES** | AES-256-GCM | 256ä½ | âœ… GCM | âœ… |
| **åº”ç”¨å±‚ç­¾å** | Ed25519 | 256ä½ | âœ… å…¬é’¥ | âœ… |

### æ”»å‡»é˜²æŠ¤

| æ”»å‡»ç±»å‹ | é˜²æŠ¤æªæ–½ | æ•ˆæœ |
|---------|---------|------|
| **çªƒå¬** | TLSåŠ å¯† | âœ… å®Œå…¨é˜²æŠ¤ |
| **ç¯¡æ”¹** | TLSå®Œæ•´æ€§ + GCM | âœ… å®Œå…¨é˜²æŠ¤ |
| **é‡æ”¾** | æ—¶é—´æˆ³ + TLSåºåˆ—å· | âœ… å®Œå…¨é˜²æŠ¤ |
| **ä¸­é—´äºº** | TLSè¯ä¹¦ + Ed25519ç­¾å | âœ… åŒé‡é˜²æŠ¤ |
| **å†’å……** | Ed25519ç­¾å | âœ… å®Œå…¨é˜²æŠ¤ |
| **æœåŠ¡å™¨æ”»ç ´** | ç«¯åˆ°ç«¯AESåŠ å¯† | âœ… å†å²æ¶ˆæ¯å®‰å…¨ |

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

**1. TLSæ¡æ‰‹å¤±è´¥**
```
é”™è¯¯: tls: first record does not look like a TLS handshake
è§£å†³: è‡ªåŠ¨å›é€€åˆ° ws:// (éTLS)
```

**2. è¯ä¹¦éªŒè¯å¤±è´¥**
```
é”™è¯¯: x509: certificate signed by unknown authority
è§£å†³: è®¾ç½® SkipTLSVerify: true (å¼€å‘ç¯å¢ƒ)
```

**3. WebSocketè¿æ¥æ–­å¼€**
```
åŸå› : å¿ƒè·³è¶…æ—¶
è§£å†³: è‡ªåŠ¨é‡è¿æœºåˆ¶ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
```

---

## ğŸ“Š æ€§èƒ½åŸºå‡†

### æ¶ˆæ¯å»¶è¿Ÿ

| åœºæ™¯ | ARPæ¨¡å¼ | HTTPSæ¨¡å¼(å±€åŸŸç½‘) | HTTPSæ¨¡å¼(äº’è”ç½‘) |
|------|---------|-------------------|-------------------|
| **1KBæ¶ˆæ¯** | ~0.2ms | ~1ms | ~50-200ms |
| **10KBæ¶ˆæ¯** | ~0.5ms | ~2ms | ~60-220ms |
| **100KBæ¶ˆæ¯** | ~3ms | ~10ms | ~100-300ms |

### ååé‡

| åœºæ™¯ | ARPæ¨¡å¼ | HTTPSæ¨¡å¼ |
|------|---------|-----------|
| **å°æ¶ˆæ¯(<1KB)** | ~5000 msg/s | ~3000 msg/s |
| **ä¸­æ¶ˆæ¯(10KB)** | ~1000 msg/s | ~800 msg/s |
| **å¤§æ¶ˆæ¯(100KB)** | ~100 msg/s | ~80 msg/s |

**ç»“è®º:** âœ… HTTPSæ¨¡å¼æ€§èƒ½æŸå¤±<30%ï¼Œå®‰å…¨æ€§å¤§å¹…æå‡

---

## âœ… æ€»ç»“

### åŠ å¯†æ¶æ„

```
åº”ç”¨å±‚: AES-256-GCMåŠ å¯† + Ed25519ç­¾å
    â†“
ä¼ è¾“å±‚: JSONåºåˆ—åŒ– + WebSocketå¸§
    â†“
TLSå±‚:  TLS 1.2+ åŠ å¯† + è¯ä¹¦è®¤è¯
    â†“
ç½‘ç»œå±‚: TCP/IP
```

### æ ¸å¿ƒç‰¹ç‚¹

1. âœ… **ä¸‰å±‚ä¿æŠ¤:** AES + ç­¾å + TLS
2. âœ… **ç«¯åˆ°ç«¯åŠ å¯†:** å³ä½¿æœåŠ¡å™¨è¢«æ”»ç ´ï¼Œæ¶ˆæ¯ä»å®‰å…¨
3. âœ… **å®Œç¾å‰å‘ä¿å¯†:** TLSä¼šè¯å¯†é’¥ç‹¬ç«‹
4. âœ… **äº’è”ç½‘é€šä¿¡:** æ”¯æŒNATç©¿é€å’Œè·¨ç½‘ç»œ
5. âœ… **æ ‡å‡†åè®®:** WebSocket + TLS
6. âœ… **è‡ªåŠ¨é‡è¿:** ç½‘ç»œä¸­æ–­è‡ªåŠ¨æ¢å¤
7. âœ… **ä½å¼€é”€:** TLSåŠ å¯†ä»…å¢åŠ ~35Î¼så»¶è¿Ÿ

### æ¨èåœºæ™¯

**å¼ºçƒˆæ¨èHTTPSæ¨¡å¼ç”¨äº:**
- ğŸŒ äº’è”ç½‘é€šä¿¡
- ğŸ¢ ä¼ä¸šç”Ÿäº§ç¯å¢ƒ
- ğŸ“± ç§»åŠ¨åº”ç”¨
- â˜ï¸ äº‘æœåŠ¡å™¨éƒ¨ç½²
- ğŸ”’ é«˜å®‰å…¨è¦æ±‚åœºæ™¯

---

**æ–‡æ¡£ç‰ˆæœ¬:** 1.0  
**æœ€åæ›´æ–°:** 2025-10-14  
**çŠ¶æ€:** âœ… å®ç°å®Œæ•´ï¼Œç”Ÿäº§å¯ç”¨



